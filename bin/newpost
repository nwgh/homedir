#!/usr/bin/env python

import argparse
import os
import uuid

postid = uuid.uuid4().hex

parser = argparse.ArgumentParser()
parser.add_argument('-n', dest='nocomments', default=False,
                    action='store_true')
parser.add_argument('-t', dest='tags', action='append')
parser.add_argument('title')
args = parser.parse_args()

lctitle = args.title.lower()
title_for_file = lctitle.replace(' ', '-').replace("'", '').replace('"', '').replace('/', '')
filename = '3000-01-01-%s.markdown' % (title_for_file,)
posts = os.getenv('BLOG_POSTS', None)
if posts is not None:
    filename = os.path.join(posts, filename)

with file(filename, 'w') as f:
    f.write('---\n')
    f.write('layout: post\n')
    f.write('title: %s\n' % (args.title,))
    f.write('date: 3000-01-01 00:00:00\n')
    if args.tags:
        f.write('tags: %s\n' % (str(args.tags),))
    if args.nocomments:
        f.write('nocomments: 1\n')
    f.write('disqusid: %s\n' % (postid,))
    f.write('---\n')
